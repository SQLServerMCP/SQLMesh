2025-12-04 07:51:02,810 - MainThread - sqlmesh.core.console - WARNING - The databricks engine is not recommended for storing SQLMesh state in production deployments. Please see https://sqlmesh.readthedocs.io/en/stable/guides/configuration/#state-connection for a list of recommended engines and more information. (console.py:2335)
2025-12-04 07:51:03,007 - MainThread - databricks.sql.session - WARNING - [WARN] Parameter '_user_agent_entry' is deprecated; use 'user_agent_entry' instead. This parameter will be removed in the upcoming releases. (session.py:55)
2025-12-04 07:51:03,210 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:03,210 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:03,210 - MainThread - databricks.sql.session - INFO - Successfully opened session 01f0d0e5-fc4d-13dc-9146-93290bc7fd8f (session.py:143)
2025-12-04 07:51:03,674 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:03,674 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:03,960 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:03,960 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:04,294 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:04,294 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:04,520 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:04,520 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:04,806 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:04,806 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:05,050 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:05,050 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:05,371 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:05,371 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:05,546 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:05,546 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:05,853 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:05,856 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:06,045 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:06,045 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:06,285 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:06,285 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:06,293 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Listing data objects in schema newbankingdemo.sqlmesh__gold (evaluator.py:1616)
2025-12-04 07:51:06,310 - MainThread - databricks.sql.session - WARNING - [WARN] Parameter '_user_agent_entry' is deprecated; use 'user_agent_entry' instead. This parameter will be removed in the upcoming releases. (session.py:55)
2025-12-04 07:51:06,499 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:06,500 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:06,500 - MainThread - databricks.sql.session - INFO - Successfully opened session 01f0d0e5-fe3f-148b-9b76-97e3a2aaf1fb (session.py:143)
2025-12-04 07:51:06,501 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: SELECT `table_name` AS `name`, `table_schema` AS `schema`, `table_catalog` AS `catalog`, CASE `table_type` WHEN 'VIEW' THEN 'view' WHEN 'MATERIALIZED_VIEW' THEN 'materialized_view' ELSE 'table' END AS `type` FROM `system`.`information_schema`.`tables` WHERE (`table_catalog` = 'newbankingdemo' AND `table_schema` = 'sqlmesh__gold') AND `table_name` IN ('gold__customers_2__2439568028', 'gold__accounts_2__2894313673', 'gold__transactions_2__3765301057') (base.py:2619)
2025-12-04 07:51:07,265 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:07,265 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:07,279 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Listing data objects in schema newbankingdemo.sqlmesh__silver (evaluator.py:1616)
2025-12-04 07:51:07,283 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: SELECT `table_name` AS `name`, `table_schema` AS `schema`, `table_catalog` AS `catalog`, CASE `table_type` WHEN 'VIEW' THEN 'view' WHEN 'MATERIALIZED_VIEW' THEN 'materialized_view' ELSE 'table' END AS `type` FROM `system`.`information_schema`.`tables` WHERE (`table_catalog` = 'newbankingdemo' AND `table_schema` = 'sqlmesh__silver') AND `table_name` IN ('silver__customers_2__562887494', 'silver__accounts_2__3741260822', 'silver__transactions_2__3316432348') (base.py:2619)
2025-12-04 07:51:07,645 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:07,645 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:08,066 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:08,066 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:08,096 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"newbankingdemo"."silver"."accounts_2": 341872557> (evaluator.py:711)
2025-12-04 07:51:08,096 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: USE CATALOG `newbankingdemo` (base.py:2619)
2025-12-04 07:51:08,329 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:08,330 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:08,333 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting data for snapshot SnapshotId<"newbankingdemo"."silver"."accounts_2": 341872557> (evaluator.py:952)
2025-12-04 07:51:08,343 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-12-03 00:00:00, 2025-12-04 00:00:00) into newbankingdemo.sqlmesh__silver.silver__accounts_2__3741260822' (evaluator.py:984)
2025-12-04 07:51:08,343 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: INSERT INTO `newbankingdemo`.`sqlmesh__silver`.`silver__accounts_2__3741260822` REPLACE WHERE TRUE SELECT CAST(`accountnumber` AS STRING) AS `accountnumber`, CAST(`customernumber` AS STRING) AS `customernumber`, CAST(`accountopeneddate` AS TIMESTAMP_NTZ) AS `accountopeneddate`, CAST(`startingbalance` AS DECIMAL(15, 2)) AS `startingbalance` FROM `newbankingdemo`.`bronze`.`accounts_2` AS `accounts_2` (base.py:2619)
2025-12-04 07:51:12,459 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:12,459 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:12,477 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-12-03 00:00:00, 2025-12-04 00:00:00) for snapshot SnapshotId<"newbankingdemo"."silver"."accounts_2": 341872557> (facade.py:637)
2025-12-04 07:51:12,477 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"newbankingdemo"."silver"."accounts_2": 341872557> (interval.py:215)
2025-12-04 07:51:15,111 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:15,111 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:15,370 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:15,371 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:15,390 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"newbankingdemo"."silver"."customers_2": 95111029> (evaluator.py:711)
2025-12-04 07:51:15,390 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: USE CATALOG `newbankingdemo` (base.py:2619)
2025-12-04 07:51:15,737 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:15,739 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:15,745 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting data for snapshot SnapshotId<"newbankingdemo"."silver"."customers_2": 95111029> (evaluator.py:952)
2025-12-04 07:51:15,755 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-12-03 00:00:00, 2025-12-04 00:00:00) into newbankingdemo.sqlmesh__silver.silver__customers_2__562887494' (evaluator.py:984)
2025-12-04 07:51:15,755 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: INSERT INTO `newbankingdemo`.`sqlmesh__silver`.`silver__customers_2__562887494` REPLACE WHERE TRUE SELECT CAST(`customernumber` AS STRING) AS `customernumber`, CAST(`firstname` AS STRING) AS `firstname`, CAST(`surname` AS STRING) AS `surname`, CAST(`dateofbirth` AS DATE) AS `dateofbirth`, CAST(`gender` AS STRING) AS `gender`, CAST(`emailaddress` AS STRING) AS `emailaddress`, CAST(`ukpostcode` AS STRING) AS `ukpostcode`, CAST(`housenumber` AS STRING) AS `housenumber`, CAST(`streetaddress` AS STRING) AS `streetaddress`, CAST(`town` AS STRING) AS `town` FROM `newbankingdemo`.`bronze`.`customers_2` AS `customers_2` (base.py:2619)
2025-12-04 07:51:19,123 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:19,123 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:19,126 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-12-03 00:00:00, 2025-12-04 00:00:00) for snapshot SnapshotId<"newbankingdemo"."silver"."customers_2": 95111029> (facade.py:637)
2025-12-04 07:51:19,127 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"newbankingdemo"."silver"."customers_2": 95111029> (interval.py:215)
2025-12-04 07:51:21,137 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:21,137 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:21,360 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:21,360 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:21,372 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"newbankingdemo"."silver"."transactions_2": 3397586131> (evaluator.py:711)
2025-12-04 07:51:21,372 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: USE CATALOG `newbankingdemo` (base.py:2619)
2025-12-04 07:51:21,700 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:21,700 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:21,700 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting data for snapshot SnapshotId<"newbankingdemo"."silver"."transactions_2": 3397586131> (evaluator.py:952)
2025-12-04 07:51:21,700 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-12-02 00:00:00, 2025-12-04 00:00:00) into newbankingdemo.sqlmesh__silver.silver__transactions_2__3316432348' (evaluator.py:984)
2025-12-04 07:51:21,718 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: MERGE INTO `newbankingdemo`.`sqlmesh__silver`.`silver__transactions_2__3316432348` AS `__MERGE_TARGET__` USING (SELECT CAST(`accountnumber` AS STRING) AS `accountnumber`, CAST(`customernumber` AS STRING) AS `customernumber`, CAST(`transactiondate` AS TIMESTAMP_NTZ) AS `transactiondate`, CAST(`transactionamount` AS DECIMAL(15, 2)) AS `transactionamount` FROM `newbankingdemo`.`bronze`.`transactions_2` AS `transactions_2`) AS `__MERGE_SOURCE__` ON `__MERGE_TARGET__`.`accountnumber` = `__MERGE_SOURCE__`.`accountnumber` AND `__MERGE_TARGET__`.`transactiondate` = `__MERGE_SOURCE__`.`transactiondate` AND `__MERGE_TARGET__`.`transactionamount` = `__MERGE_SOURCE__`.`transactionamount` WHEN MATCHED THEN UPDATE SET `__MERGE_TARGET__`.`accountnumber` = `__MERGE_SOURCE__`.`accountnumber`, `__MERGE_TARGET__`.`customernumber` = `__MERGE_SOURCE__`.`customernumber`, `__MERGE_TARGET__`.`transactiondate` = `__MERGE_SOURCE__`.`transactiondate`, `__MERGE_TARGET__`.`transactionamount` = `__MERGE_SOURCE__`.`transactionamount` WHEN NOT MATCHED THEN INSERT (`accountnumber`, `customernumber`, `transactiondate`, `transactionamount`) VALUES (`__MERGE_SOURCE__`.`accountnumber`, `__MERGE_SOURCE__`.`customernumber`, `__MERGE_SOURCE__`.`transactiondate`, `__MERGE_SOURCE__`.`transactionamount`) (base.py:2619)
2025-12-04 07:51:26,930 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:26,930 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:31,092 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:31,092 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:31,165 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:31,165 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:31,223 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:31,224 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:31,226 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-12-02 00:00:00, 2025-12-04 00:00:00) for snapshot SnapshotId<"newbankingdemo"."silver"."transactions_2": 3397586131> (facade.py:637)
2025-12-04 07:51:31,226 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"newbankingdemo"."silver"."transactions_2": 3397586131> (interval.py:215)
2025-12-04 07:51:33,021 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:33,021 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:33,237 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:33,237 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:33,251 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"newbankingdemo"."gold"."accounts_2": 3101799127> (evaluator.py:711)
2025-12-04 07:51:33,253 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: USE CATALOG `newbankingdemo` (base.py:2619)
2025-12-04 07:51:33,348 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:33,348 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:33,655 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:33,655 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:33,670 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting data for snapshot SnapshotId<"newbankingdemo"."gold"."accounts_2": 3101799127> (evaluator.py:952)
2025-12-04 07:51:33,672 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-12-03 00:00:00, 2025-12-04 00:00:00) into newbankingdemo.sqlmesh__gold.gold__accounts_2__2894313673' (evaluator.py:984)
2025-12-04 07:51:33,689 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: INSERT INTO `newbankingdemo`.`sqlmesh__gold`.`gold__accounts_2__2894313673` REPLACE WHERE TRUE SELECT CAST(`accounts_2`.`accountnumber` AS STRING) AS `accountnumber`, CAST(`accounts_2`.`customernumber` AS STRING) AS `customernumber`, CAST(YEAR(`accounts_2`.`accountopeneddate`) AS INT) AS `accountopenedyear`, CAST(MONTH(`accounts_2`.`accountopeneddate`) AS INT) AS `accountopenedmonth`, CAST(DAY(`accounts_2`.`accountopeneddate`) AS INT) AS `accountopenedday`, CAST(DAYNAME(`accounts_2`.`accountopeneddate`) AS STRING) AS `accountopeneddayname`, CAST(`accounts_2`.`startingbalance` AS DECIMAL(15, 2)) AS `startingbalance` FROM `newbankingdemo`.`sqlmesh__silver`.`silver__accounts_2__3741260822` AS `accounts_2` (base.py:2619)
2025-12-04 07:51:36,105 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:36,105 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:36,119 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-12-03 00:00:00, 2025-12-04 00:00:00) for snapshot SnapshotId<"newbankingdemo"."gold"."accounts_2": 3101799127> (facade.py:637)
2025-12-04 07:51:36,119 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"newbankingdemo"."gold"."accounts_2": 3101799127> (interval.py:215)
2025-12-04 07:51:37,627 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:37,627 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:37,870 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:37,870 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:37,888 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"newbankingdemo"."gold"."customers_2": 1076732822> (evaluator.py:711)
2025-12-04 07:51:37,889 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: USE CATALOG `newbankingdemo` (base.py:2619)
2025-12-04 07:51:38,107 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:38,107 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:38,109 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting data for snapshot SnapshotId<"newbankingdemo"."gold"."customers_2": 1076732822> (evaluator.py:952)
2025-12-04 07:51:38,118 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-12-03 00:00:00, 2025-12-04 00:00:00) into newbankingdemo.sqlmesh__gold.gold__customers_2__2439568028' (evaluator.py:984)
2025-12-04 07:51:38,118 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: INSERT INTO `newbankingdemo`.`sqlmesh__gold`.`gold__customers_2__2439568028` REPLACE WHERE TRUE SELECT CAST(`customers_2`.`customernumber` AS STRING) AS `customernumber`, CAST(`customers_2`.`dateofbirth` AS DATE) AS `dateofbirth`, CAST(`customers_2`.`gender` AS STRING) AS `gender`, CAST(`customers_2`.`ukpostcode` AS STRING) AS `ukpostcode` FROM `newbankingdemo`.`sqlmesh__silver`.`silver__customers_2__562887494` AS `customers_2` (base.py:2619)
2025-12-04 07:51:40,264 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:40,264 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:40,264 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-12-03 00:00:00, 2025-12-04 00:00:00) for snapshot SnapshotId<"newbankingdemo"."gold"."customers_2": 1076732822> (facade.py:637)
2025-12-04 07:51:40,264 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"newbankingdemo"."gold"."customers_2": 1076732822> (interval.py:215)
2025-12-04 07:51:42,204 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:42,204 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:42,468 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:42,469 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:42,489 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"newbankingdemo"."gold"."transactions_2": 3992093364> (evaluator.py:711)
2025-12-04 07:51:42,491 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: USE CATALOG `newbankingdemo` (base.py:2619)
2025-12-04 07:51:42,904 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:42,904 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:42,917 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting data for snapshot SnapshotId<"newbankingdemo"."gold"."transactions_2": 3992093364> (evaluator.py:952)
2025-12-04 07:51:42,933 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-12-02 00:00:00, 2025-12-04 00:00:00) into newbankingdemo.sqlmesh__gold.gold__transactions_2__3765301057' (evaluator.py:984)
2025-12-04 07:51:42,933 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: MERGE INTO `newbankingdemo`.`sqlmesh__gold`.`gold__transactions_2__3765301057` AS `__MERGE_TARGET__` USING (SELECT CAST(`transactions_2`.`accountnumber` AS STRING) AS `accountnumber`, CAST(`transactions_2`.`customernumber` AS STRING) AS `customernumber`, CAST(YEAR(`transactions_2`.`transactiondate`) AS INT) AS `transactionyear`, CAST(MONTH(`transactions_2`.`transactiondate`) AS INT) AS `transactionmonth`, CAST(MONTHNAME(`transactions_2`.`transactiondate`) AS STRING) AS `transactionmonthname`, CAST(DAY(`transactions_2`.`transactiondate`) AS INT) AS `transactionday`, CAST(DAYNAME(`transactions_2`.`transactiondate`) AS STRING) AS `transactiondayname`, CAST(`transactions_2`.`transactionamount` AS DECIMAL(15, 2)) AS `transactionamount` FROM `newbankingdemo`.`sqlmesh__silver`.`silver__transactions_2__3316432348` AS `transactions_2`) AS `__MERGE_SOURCE__` ON `__MERGE_TARGET__`.`accountnumber` = `__MERGE_SOURCE__`.`accountnumber` AND `__MERGE_TARGET__`.`transactiondate` = `__MERGE_SOURCE__`.`transactiondate` AND `__MERGE_TARGET__`.`transactionamount` = `__MERGE_SOURCE__`.`transactionamount` WHEN MATCHED THEN UPDATE SET `__MERGE_TARGET__`.`accountnumber` = `__MERGE_SOURCE__`.`accountnumber`, `__MERGE_TARGET__`.`customernumber` = `__MERGE_SOURCE__`.`customernumber`, `__MERGE_TARGET__`.`transactionyear` = `__MERGE_SOURCE__`.`transactionyear`, `__MERGE_TARGET__`.`transactionmonth` = `__MERGE_SOURCE__`.`transactionmonth`, `__MERGE_TARGET__`.`transactionmonthname` = `__MERGE_SOURCE__`.`transactionmonthname`, `__MERGE_TARGET__`.`transactionday` = `__MERGE_SOURCE__`.`transactionday`, `__MERGE_TARGET__`.`transactiondayname` = `__MERGE_SOURCE__`.`transactiondayname`, `__MERGE_TARGET__`.`transactionamount` = `__MERGE_SOURCE__`.`transactionamount` WHEN NOT MATCHED THEN INSERT (`accountnumber`, `customernumber`, `transactionyear`, `transactionmonth`, `transactionmonthname`, `transactionday`, `transactiondayname`, `transactionamount`) VALUES (`__MERGE_SOURCE__`.`accountnumber`, `__MERGE_SOURCE__`.`customernumber`, `__MERGE_SOURCE__`.`transactionyear`, `__MERGE_SOURCE__`.`transactionmonth`, `__MERGE_SOURCE__`.`transactionmonthname`, `__MERGE_SOURCE__`.`transactionday`, `__MERGE_SOURCE__`.`transactiondayname`, `__MERGE_SOURCE__`.`transactionamount`) (base.py:2619)
2025-12-04 07:51:43,931 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:43,931 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:43,989 - MainThread - sqlmesh.core.scheduler - INFO - Execution failed for node EvaluateNode(snapshot_name='"newbankingdemo"."gold"."transactions_2"', interval=(1764633600000, 1764806400000), batch_index=0) (scheduler.py:618)
Traceback (most recent call last):
  File "C:\Users\darki\Documents\Platform\env\Lib\site-packages\sqlmesh\utils\concurrency.py", line 234, in sequential_apply_to_dag
    fn(node)
  File "C:\Users\darki\Documents\Platform\env\Lib\site-packages\sqlmesh\core\scheduler.py", line 554, in run_node
    audit_results = self.evaluate(
                    ^^^^^^^^^^^^^^
  File "C:\Users\darki\Documents\Platform\env\Lib\site-packages\sqlmesh\core\scheduler.py", line 229, in evaluate
    wap_id = self.snapshot_evaluator.evaluate(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\darki\Documents\Platform\env\Lib\site-packages\sqlmesh\core\snapshot\evaluator.py", line 186, in evaluate
    result = self._evaluate_snapshot(
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\darki\Documents\Platform\env\Lib\site-packages\sqlmesh\core\snapshot\evaluator.py", line 821, in _evaluate_snapshot
    self._render_and_insert_snapshot(
  File "C:\Users\darki\Documents\Platform\env\Lib\site-packages\sqlmesh\core\snapshot\evaluator.py", line 1041, in _render_and_insert_snapshot
    apply(query_or_df, index)
  File "C:\Users\darki\Documents\Platform\env\Lib\site-packages\sqlmesh\core\snapshot\evaluator.py", line 990, in apply
    evaluation_strategy.insert(
  File "C:\Users\darki\Documents\Platform\env\Lib\site-packages\sqlmesh\core\snapshot\evaluator.py", line 2297, in insert
    self.adapter.merge(
  File "C:\Users\darki\Documents\Platform\env\Lib\site-packages\sqlmesh\core\engine_adapter\shared.py", line 318, in internal_wrapper
    return func(*list_args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\darki\Documents\Platform\env\Lib\site-packages\sqlmesh\core\engine_adapter\base.py", line 2261, in merge
    self._merge(
  File "C:\Users\darki\Documents\Platform\env\Lib\site-packages\sqlmesh\core\engine_adapter\base.py", line 1729, in _merge
    self.execute(
  File "C:\Users\darki\Documents\Platform\env\Lib\site-packages\sqlmesh\core\engine_adapter\base.py", line 2596, in execute
    self._execute(sql, track_rows_processed, **kwargs)
  File "C:\Users\darki\Documents\Platform\env\Lib\site-packages\sqlmesh\core\engine_adapter\base.py", line 2628, in _execute
    self.cursor.execute(sql, **kwargs)
  File "C:\Users\darki\Documents\Platform\env\Lib\site-packages\databricks\sql\telemetry\latency_logger.py", line 175, in wrapper
    result = func(self, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\darki\Documents\Platform\env\Lib\site-packages\databricks\sql\client.py", line 1293, in execute
    self.active_result_set = self.backend.execute_command(
                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\darki\Documents\Platform\env\Lib\site-packages\databricks\sql\backend\thrift_backend.py", line 1058, in execute_command
    execute_response, has_more_rows = self._handle_execute_response(
                                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\darki\Documents\Platform\env\Lib\site-packages\databricks\sql\backend\thrift_backend.py", line 1265, in _handle_execute_response
    final_operation_state = self._wait_until_command_done(
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\darki\Documents\Platform\env\Lib\site-packages\databricks\sql\backend\thrift_backend.py", line 944, in _wait_until_command_done
    self._check_command_not_in_error_or_closed_state(
  File "C:\Users\darki\Documents\Platform\env\Lib\site-packages\databricks\sql\backend\thrift_backend.py", line 635, in _check_command_not_in_error_or_closed_state
    raise ServerOperationError(
databricks.sql.exc.ServerOperationError: [DELTA_MERGE_UNRESOLVED_EXPRESSION] Cannot resolve __MERGE_TARGET__.transactiondate in search condition given columns __MERGE_TARGET__.accountnumber, __MERGE_TARGET__.customernumber, __MERGE_TARGET__.transactionyear, __MERGE_TARGET__.transactionmonth, __MERGE_TARGET__.transactionmonthname, __MERGE_TARGET__.transactionday, __MERGE_TARGET__.transactiondayname, __MERGE_TARGET__.transactionamount, __MERGE_SOURCE__.accountnumber, __MERGE_SOURCE__.customernumber, __MERGE_SOURCE__.transactionyear, __MERGE_SOURCE__.transactionmonth, __MERGE_SOURCE__.transactionmonthname, __MERGE_SOURCE__.transactionday, __MERGE_SOURCE__.transactiondayname, __MERGE_SOURCE__.transactionamount.; line 1 pos 940

The above exception was the direct cause of the following exception:

sqlmesh.utils.concurrency.NodeExecutionFailedError: Execution failed for node EvaluateNode(snapshot_name='"newbankingdemo"."gold"."transactions_2"', interval=(1764633600000, 1764806400000), batch_index=0)
2025-12-04 07:51:44,175 - MainThread - databricks.sql.session - INFO - Closing session 01f0d0e5-fe3f-148b-9b76-97e3a2aaf1fb (session.py:194)
2025-12-04 07:51:44,296 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:44,296 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:44,311 - MainThread - databricks.sql.session - INFO - Closing session 01f0d0e5-fc4d-13dc-9146-93290bc7fd8f (session.py:194)
2025-12-04 07:51:44,378 - MainThread - databricks.sql.auth.retry - INFO - Received status code 200 for POST request (retry.py:355)
2025-12-04 07:51:44,378 - MainThread - databricks.sql.auth.thrift_http_client - INFO - HTTP Response with status code 200, message: OK (thrift_http_client.py:208)
2025-12-04 07:51:44,418 - MainThread - root - INFO - Shutting down the event dispatcher (dispatcher.py:159)
